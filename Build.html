<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<!--
 * This Source Code Form is subject to the terms of the Mozilla Public License,
 * v. 2.0. If a copy of the MPL was not distributed with this file, You can
 * obtain one at http://mozilla.org/MPL/2.0/
 *
 * Copyright (C) 2009-2012, Peter Johnson (www.delphidabbler.com).
 *
 * $Rev$
 * $Date$
 *
 * Instructions for building PasHi and PasHiGUI.
-->

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<html>

<head>
	<title>
		Building PasHi
	</title>
	<style>
		body {
			font-family: sans-serif;
		}
		dt.spaced {
			margin-top: 0.5em;
		}
		h1 {
			text-align: center;
		}
		h2 {
			padding-bottom: 0.25em;
			border-bottom: 1px silver solid;
		}
		ul.spaced li,
		ol.spaced li {
			margin-top: 0.5em;
		}
		p, pre, div.spaced {
			padding: 0;
			margin: 0.5em 0;
		}
		div.close-spaced, pre.close-spaced {
			padding: 0;
			margin: 0.25em; 0;
		}
		.box, .cmd {
			padding: 0.25em;
			background-color: #eef;
			border: 1px solid silver;
		}
		.cmd {
			margin-left: 2em;
			margin-right: 2em;
			font-weight: bold;
		}
		.disabled {
			color: gray;
		}
		.prompt {
			color: blue;
		}
	</style>
</head>

<body>

<h1>
	PasHi Build Instructions
</h1>

<h2>
	Introduction
</h2>

<p>
	These instructions show how to build the <em>PasHi</em> command line program
	and, optionally, <em>PasHiGUI</em> - the GUI front end to <em>PasHi</em>.
</p>

<p>
	The programs are written in Object Pascal and are targetted at Delphi 2010.
</p>

<p>
	The Delphi IDE can be used to modify the source and to perform test builds.
	Final builds should be built using the provided makefiles, but you can get
	away with using the IDE if you don't change any resources.
</p>

<div class="box">

	<p>
		<strong>Note:</strong>
		These instructions do not apply to the following versions of the program:
  </p>

  <ul>
    <li>
      Release 1.1.0. See the version of <code>Build.html</code> in the
      <code>tags/version-1.1.0</code> branch of the repository.
    </li>
    <li>
      <em>PasH</em> <sup><span style="font-size:smaller;">&dagger;</span></sup>
      release 1.0.0 or earlier or
      <em>PasHGUI</em>
      <sup><span style="font-size:smaller;">&dagger;</span></sup> release 0.1.0.
      For instructions on how to build these versions please refer to the
      <code>ReadMe-Src.txt</code> files that are to be found in the
      <code>Docs</code> or root directories of the relevant source code trees.
    </li>
	</ul>

	<p style="font-size:smaller;">
		<sup><span style="font-size:smaller;">&dagger;</span></sup> <em>PasH</em>
    and <em>PasHGUI</em> are the old names for <em>PasHi</em> and
    <em>PasHiGUI</em>.
	</p>

</div>

<h2>
	Dependencies
</h2>

<h3>
	Libraries
</h3>

<h4>
	PasHi
</h4>

<p>
		No libraries are required to build <em>PasHi</em>
</p>

<h4>
	PasHiGUI
</h4>

<p>
	No libraries are required to build <em>PasHiGUI</em>
</p>

<h3>
	Delphi VCL
</h3>

<p>
	You need the relevant Delphi VCL in order to compile the programs.
</p>

<h2>
	Build Tools
</h2>

<p>
	The following tools are needed to build the programs.
</p>

<h3>
	Delphi
</h3>

<p>
	A copy of Delphi is required to build the object Pascal code. Delphi 2010
	is the preferred compiler.
</p>

<div class="box">
	The code should be able to compile with Delphi XE and later. It is possible
  that Delphi 2009 may compile the code, but it hasn't been tested. Versions
  earlier than Delphi 2009 are not suitable due to their lack of Unicode
  support.
</div>

<p>
	You can use the Delphi IDE to edit the code and test compile it. The
	makefiles require the following command line tools:
</p>

<dl>
	<dt class="spaced">
		<code>DCC32</code>
	</dt>
	<dd>
		The Delphi command line compiler.
	</dd>
	<dt class="spaced">
		<code>BRCC32</code>
	</dt>
	<dd>
		The Borland resource compiler. Used to compile various resource source
		(<code>.rc</code>) files.
	</dd>
</dl>

<p>
	The following environment variables are associated with these tools:
</p>

<dl>
	<dt class="spaced">
		<code>DELPHIROOT</code> - required unless <code>DELPHI2010</code> is
		set.
	</dt>
	<dd>
		Should be set to the install directory of the version of Delphi being
		used. <code>DCC32</code> and <code>BRCC32</code> are expected to be in
		the <code>Bin</code> sub-directory of <code>DELPHIROOT</code>.
	</dd>
	<dt class="spaced">
		<code>DELPHI2010</code> - optional
	</dt>
	<dd>
		If you are using Delphi 2010 this environment variable should be set
		to the Delphi install directory. When <code>DELPHI2010</code> is specified
    <code>DELPHIROOT</code> will ignore its own value and use the value of
    <code>DELPHI2010</code> instead.
	</dd>
</dl>

<h3>
	Borland MAKE
</h3>

<p>
	This is the make tool that ships with Delphi. You can use any version that
	works. 
</p>

<h3>
	DelphiDabbler Version Information Editor (VIEd)
</h3>

<p>
	This tool is used to compile version information (<code>.vi</code>) files
	into intermediate resource source (<code>.rc</code>) files. Version 2.11.2
	or later is required. Version Information Editor can be obtained from
	<a
		href="http://www.delphidabbler.com/software/vied"
	>http://www.delphidabbler.com/software/vied</a>.
</p>

<p>
	The program is expected to be on the path unless its install directory is
	specified by the <code>VIEDROOT</code> environment variable.
</p>

<h3>
  Inno Setup
</h3>

<p>
  The Unicode version on the Inno setup command line compiler is needed to
  create <em>CodeSnip</em>'s install program. v5.4.0 (u) or later is required as
  is a compatible version of the ISPP pre-processor. You can get Inno Setup with
  ISPP at <a
    href="http://www.jrsoftware.org/isinfo.php"
  >http://www.jrsoftware.org/isinfo.php</a>. Choose the Unicode version. If you
  already have the ANSI version the Unicode version can be installed alongside
  it - just use a different install directory and program group name.
</p>

<p>
  The program is expected to be on the path unless its install directory is
  specified by the <code>INNOSETUP</code> environment variable.
</p>

<h3>
	Zip
</h3>

<p>
	This program is used to create release files. You can get a Windows command
	line version at
	<a
		href="http://stahlforce.com/dev/index.php?tool=zipunzip"
	>http://stahlforce.com/dev/index.php?tool=zipunzip</a>.
</p>

<p>
	The program is expected to be on the path unless its install directory is
	specified by the <code>ZIPROOT</code> environment variable.
</p>

<h2>
	Preparation
</h2>

<h3>
	Configure the environment.
</h3>

<p>
	The first step is to configure the required <code>DELPHIROOT</code> or
	<code>DELPHI2010</code> environment variables.
</p>

<p>
	Next, set any of the optional <code>VIEDROOT</code>, <code>INNOSETUP</code>
  and <code>ZIPROOT</code> environment variables that are needed to specify the
  path to any tools that are not on the system path.
</p>

<p>
	You can configure environment variables either by modifying your system
	environment variables or by creating a batch file that you run before
	performing the build.
</p>

<h3>
	Get the Source Code
</h3>

<p>
	If you don't already have it, download or checkout the <em>PasHi</em> source
	code, which should include the source for <em>PasHiGUI</em>. There are
	several options:
</p>

<div class="box" style="color:red;">
  NOTE: All references to <code>trunk</code> below need to be replaced by
  <code>branches/v2-dev</code> until the v2 code is re-integrated into
  <code>trunk.</code>
</div>

<ol class="spaced">
	<li>
		<div>
			If you are a Subversion user you can:
		</div>
		<ul class="spaced">
			<li>
				<div>
					Check out the source using the following command:
				</div>
				<pre class="cmd"><span class="prompt">&gt;</span> svn checkout http://pas-hi.googlecode.com/svn/trunk/ PATH</pre>
				<div>
					Where <code>PATH</code> is the directory where you want to
					place the working copy. You will not be able to commit
					changes unless you join the project as a contributor.
				</div>
			</li>
			<li>
				<div>
					Export the code using this command:
				</div>
				<pre class="cmd"><span class="prompt">&gt;</span> svn export http://pas-hi.googlecode.com/svn/trunk/ PATH</pre>
				<div>
					where <code>PATH</code> is the directory where you wish to
					store the code.
				</div>
			</li>
		</ul>
		<div class="spaced">
			These commands get code from the current development tree. To get
			the code of a suitable stable release replace <code>trunk</code>
			with <code>tags/XXXX</code> where <code>XXX</code> specifies the
			version.
		</div>
	</li>
	<li>
		Download a suitable source zip file from <a
			href="http://code.google.com/p/pas-hi/downloads/list?can=2&q=type=source&sort=filename&colspec=Filename%20Summary%20Type%20Uploaded%20Size%20DownloadCount"
		>Google Code</a>.
	</li> 
	<li>
		Grab the source code of the latest release from <a
			href="http://www.delphidabbler.com/software/pash/download"
		>DelphiDabbler.com</a>.
	</li>
</ol>

<p class="box">
	If you modify the code and want to submit it for inclusion in the repository
	please raise a new issue in the <a
		href="http://code.google.com/p/pas-hi/issues/list"
	>issue tracker</a>, select a type (defect, enhancement etc.) and attach a
	zip file or tarball containing your enhancment, preferably including a patch
  file.
</p>

<h3>
	Configure the Source Tree
</h3>

<p>
	After checking out or downloading and extracting the source code you should
	have the following directory structure:
</p>

<pre>./
  |
  +-- Config                - config files to be installed with PasHi
  |
  +-- Docs                  - documentation
  |
  +-- Src                   - source code for PasHi
  |   |
  |   +-- 3rdParty          - any third party source code required by PasHi
  |   |
  |   +-- Assets            - assets required to build PasHi's resources
  |   |
  |   +-- GUI               - source code of the GUI application, PasHiGUI
  |       |
  |       +-- Resources     - assets required to build PasHiGUI's resources
  |     
  +-- Test                  - contains test file</pre>
  
<p>
	If, by chance, you also have a <code>Bin</code>, <code>Exe</code> and
	<code>Release</code> directory don't worry - all will become clear. 
	Subversion users may also see the usual <code>.svn</code> &quot;hidden&quot;
	directories or directory. If you have done some editing you may also see
  occasional &quot;hidden&quot; <code>__history</code> folders.
</p>

<p>
	Before you can get hacking, you need to prepare the source code tree. Open a
	command console and navigate into the <code>Src</code> sub-folder. Run any
	script you have created to set the required environment variables then do:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make config</pre>

<p>
	You may need to replace <code>Make</code> with the full path to
	<code>Make</code> if it isn't on the path, or if the <code>Make</code> that
	runs isn't the Borland / CodeGear version. If this is the case try:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> %DELPHIROOT%\Bin\Make config</pre>

<p>
	or
</p>
  
<pre class="cmd"><span class="prompt">Src&gt;</span> %DELPHI2010%\Bin\Make config</pre>

<p>
	depending on which environment variable you have set.
</p>

<p>
	Once <code>Make config</code> has completed your folder structure should
	have acquired the following new folders:
</p>

<pre>./
  +-- Bin                   - receives object files and .res files for PasHi
  <span class="disabled">|
  +-- Config                - config files to be installed with PasHi
  |
  +-- Docs                  - documentation
  |</span>
  +-- Exe                   - receives executable code
  |
  +-- Release               - receives release files
  <span class="disabled">|
  +-- Src                   - source code for PasHi
  |   |
  |   +-- 3rdParty          - any third party source code required by PasHi
  |   |
  |   +-- Assets            - assets required to build PasHi's resources
  |   |
  |   +-- GUI               - source code of the GUI application, PasHiGUI
  |       |
  |       +-- Resources     - assets required to build PasHiGUI's resources
  |     
  +-- Test                  - contains test file</span></pre>

<p>
	<code>Make</code> will have created a <code>.cfg</code> file from the template
  in the <code>Src</code> folder. <code>.cfg</code> files are needed for DCC32
  to run correctly This new file will be ignored by Subversion.
</p>

<p>
	If you also want to compile <em>PasHiGUI</em> you must now do:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> cd GUI
<span class="prompt">Src\GUI&gt;</span> Make config
<span class="prompt">Src\GUI&gt;</span> cd ..</pre>

<p>
	This runs a separate makefile in the GUI directory and further configures
	the source tree to enable <em>PasHiGUI</em> to be compiled. The source tree
	should have been changed slightly to look like this:
</p>

<pre>./
  <span class="disabled">+-- Bin                   - receives object files and .res files for PasHi</span>
  |   |
  |   +-- GUI
  <span class="disabled">|
  +-- Config                - config files to be installed with PasHi
  |
  +-- Docs                  - documentation
  |
  +-- Exe                   - receives executable code
  |
  +-- Release               - receives release files
  |
  +-- Src                   - source code for PasHi
  |   |
  |   +-- 3rdParty          - any third party source code required by PasHi
  |   |
  |   +-- Assets            - assets required to build PasHi's resources
  |   |
  |   +-- GUI               - source code of the GUI application, PasHiGUI
  |       |
  |       +-- Resources     - assets required to build PasHiGUI's resources
  |     
  +-- Test                  - contains test file</span></pre>


<p>
	<code>Make</code> will also have created the required <code>.cfg</code> file
	in the <code>Src\GUI</code> directory.
</p>

<p>
	If you are intending to use the Delphi IDE to compile code, you should also
	do:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make resources</pre>

<p>
	and, for <em>PasHiGUI</em>:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> cd GUI
<span class="prompt">Src\GUI&gt;</span> Make resources
<span class="prompt">Src\GUI&gt;</span> cd ..</pre>

<p>
	This compiles the resource files that the IDE needs to link into compiled
	executables.
</p>

<p>
	You are now ready to build the source.
</p>

<h2>
	Building The Programs
</h2>

<h3>
  Creating The Executables
</h3>

<p>
	Once the source tree has been configured, and before you can build the
	Pascal code, you must create the program's resources. For <em>PasHi</em> do:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make resources</pre>

<p>
	and for <em>PasHiGUI</em> do:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> cd GUI
<span class="prompt">Src\GUI&gt;</span> Make resources
<span class="prompt">Src\GUI&gt;</span> cd ..</pre>

<p>
	And now you can build the Pascal code:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make pascal</pre>

<p>
	or
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> cd GUI
<span class="prompt">Src\GUI&gt;</span> Make pascal
<span class="prompt">Src\GUI&gt;</span> cd ..</pre>

<p>
	Should you want to build an executable from a clean source tree there is a
	shortcut. Simply running:
</p>

<pre class="cmd"><span class="prompt">&gt;</span> Make</pre>

<p>
	on its own is the same as doing:
</p>

<pre class="cmd"><span class="prompt">&gt;</span> Make config
<span class="prompt">&gt;</span> Make resources
<span class="prompt">&gt;</span> Make pascal</pre>

<p>
	So, to build <em>PasHi</em> and <em>PasHiGUI</em> and place
	<code>PasHi.exe</code> and <code>PasHiGUI.exe</code> in the <code>Exe</code>
	folder do this:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make
<span class="prompt">Src&gt;</span> cd GUI
<span class="prompt">Src\GUI&gt;</span> Make
<span class="prompt">Src\GUI&gt;</span> cd ..</pre>

<p>
  There's a shortcut for building <em>PasHiGUI</em>: using the main makefile
  just do:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make pashigui</pre>

<p>
  When both the <em>PasHi</em> and <em>PasHiGUI</em> executables have been built
  you can create the setup program. This is done from the main makefile with:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make pashigui</pre>

<h3>
	Creating the Release zip file
</h3>

<p>
  Once the setup program has been generated you can create a zip file containing
  the setup program and the required documentation files. You create the zip
  by doing:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make release</pre>

<p>
	Note that this only works with the makefile in the <code>Src</code> directory:
	the <code>release</code> target is not supported by
	<code>Src\GUI\Makefile</code>.
</p>

<p>
	By default the release file is called <code>dd-pashi.zip</code>. You can
	change this name by defining the <code>RELEASEFILENAME</code> enviroment
	variable or macro. For example, you can name the release
	<code>MyRelease.zip</code> by doing:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make -DRELEASEFILENAME=MyRelease release</pre>

<p>
	Release zip files are always placed in the <code>Release</code>
	directory. The directory is created if it doesn't exist.
</p>

<h3>
  One-shot Build and Release
</h3>

<p>
  When you are ready to created a release there is a shortcut you can you to
  configure the source tree, build the executables then the setup program and
  finally package the release zip file. Use the following command:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make all</pre>

<p>
  Once again you can change the release file name using the
  <code>RELEASEFILENAME</code> environment variable or macro:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make -DRELEASEFILENAME=MyRelease all</pre>

<h2>
	Clean Up
</h2>

<p>
	Various temporary files and directories are created by the IDE. These can be
	deleted by running:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make clean</pre>

<p>
	This command is only available in the makefile in the <code>Src</code>
	directory and acts on the whole source tree, including the <code>GUI</code>
	sub-tree.
</p>

<p>
	Be warned that this command removes any <code>__history</code> folders that
	some Delphi uses to record earlier versions of files. 
</p>

<p>
	<code>Make clean</code> leaves behind the files and directories created by
	<code>Make config</code>. To delete these files and folders in addition to
	performing a normal clean run:
</p>

<pre class="cmd"><span class="prompt">Src&gt;</span> Make deepclean</pre>

<p>
	Once again this command deep cleans both the <code>Src</code> and
	<code>Src\GUI</code> directories.
</p>

<h2>
	Copyright
</h2>

<p>
	If you are planning to re-use or modify any of the code, please see the
	<code>SourceCodeLicenses.txt</code> file in the <code>Docs</code> directory
	for an overview of the open source licenses that apply to the source code.
</p>

</body>

</html>